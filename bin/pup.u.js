// Generated by CoffeeScript 1.3.3
((function(){var a,b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br=function(a,b){return function(){return a.apply(b,arguments)}},bs=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},bt={}.hasOwnProperty,bu=function(a,b){function d(){this.constructor=a}for(var c in b)bt.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};X=function(){function a(){this.implode=br(this.implode,this),this.intervalMessages=br(this.intervalMessages,this),this.startAfkInterval=br(this.startAfkInterval,this),this.setInternalWaitlist=br(this.setInternalWaitlist,this),this.reminderCheck=br(this.reminderCheck,this),this.userJoin=br(this.userJoin,this),this.startup=br(this.startup,this)}return a.prototype.currentsong={},a.prototype.users={},a.prototype.djs=[],a.prototype.mods=[],a.prototype.host=[],a.prototype.hasWarned=!1,a.prototype.currentwoots=0,a.prototype.currentmehs=0,a.prototype.currentcurates=0,a.prototype.internalWaitlist=[],a.prototype.userDisconnectLog=[],a.prototype.voteLog={},a.prototype.seshOn=!1,a.prototype.seshMembers=[],a.prototype.launchTime=null,a.prototype.totalVotingData={woots:0,mehs:0,curates:0},a.prototype.pupScriptUrl="http://den.johnback.us/js/pup.js",a.prototype.afkTime=72e4,a.prototype.songIntervalMessages=[{interval:15,offset:0,msg:"/fb"},{interval:21,offset:0,msg:"Wondering what songs we consider overplayed? Learn more by typing /overplayed"},{interval:19,offset:0,msg:"Are you new to the den?  Type /roomhelp to get started."},{interval:17,offset:0,msg:"Wondering how the den's Power Users never get removed for being afk? Type /whywoot to find out"},{interval:23,offset:0,msg:"Theres a reason Justin Beiber isn't played here. We restrict songs to certain genres. Learn more by typing /theme"},{interval:50,offset:17,msg:"Fun fact: 0 of current and past moderators ASKED to be a moderator.  They earned it by being good users.  Shocking, I know."},{interval:100,offset:23,msg:"Did you miss our first Promoters Night?  Check out all the songs played that night here: http://goo.gl/fxEek"}],a.prototype.reminders=[],a.prototype.songCount=0,a.prototype.startup=function(){return this.launchTime=new Date},a.prototype.newSong=function(){return this.totalVotingData.woots+=this.currentwoots,this.totalVotingData.mehs+=this.currentmehs,this.totalVotingData.curates+=this.currentcurates,this.setInternalWaitlist(),this.reminderCheck(),this.currentsong=API.getMedia(),this.currentsong!==null?this.currentsong:!1},a.prototype.userJoin=function(a){var b,d;return b=Object.keys(this.users),(d=a.id,bs.call(b,d)>=0)?this.users[a.id].inRoom(!0):(this.users[a.id]=new c(a),this.voteLog[a.id]={})},a.prototype.reminderCheck=function(){var a,b,c,d,e,f;a=0,e=this.reminders,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],console.log("arr > item",this.reminders,this.reminders[a]),f.push(a++);return f},a.prototype.setInternalWaitlist=function(){var a,b,c;return a=API.getDJs().slice(1),c=API.getWaitList(),b=a.concat(c),this.internalWaitlist=b},a.prototype.activity=function(a){if(a.type==="message")return this.users[a.fromID].updateActivity()},a.prototype.startAfkInterval=function(){return this.afkInterval=setInterval(d,2e3)},a.prototype.intervalMessages=function(){var a,b,c,d,e;this.songCount++,d=this.songIntervalMessages,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],(this.songCount+a.offset)%a.interval===0?(console.log(a.msg),e.push(API.sendChat(a.msg))):(console.log(a),e.push(console.log(this.songCount)));return e},a.prototype.implode=function(){var a,b;for(a in this)b=this[a],typeof this[a]=="object"&&delete this[a];return clearInterval(this.afkInterval)},a.prototype.lockBooth=function(a){return a==null&&(a=null),$.ajax({url:"http://www.plug.dj/gateway/room.update_options",type:"POST",data:JSON.stringify({service:"room.update_options",body:["dubstep-den",{boothLocked:!0,waitListEnabled:!0,maxPlays:1,maxDJs:5}]}),async:this.async,dataType:"json",contentType:"application/json"}).done(function(){if(a!=null)return a()})},a.prototype.unlockBooth=function(a){return a==null&&(a=null),$.ajax({url:"http://www.plug.dj/gateway/room.update_options",type:"POST",data:JSON.stringify({service:"room.update_options",body:["dubstep-den",{boothLocked:!1,waitListEnabled:!0,maxPlays:1,maxDJs:5}]}),async:this.async,dataType:"json",contentType:"application/json"}).done(function(){if(a!=null)return a()})},a}(),t=new X,c=function(){function a(a){this.user=a,this.updateVote=br(this.updateVote,this),this.inRoom=br(this.inRoom,this),this.notDj=br(this.notDj,this),this.warn=br(this.warn,this),this.getIsDj=br(this.getIsDj,this),this.getWarningCount=br(this.getWarningCount,this),this.getUser=br(this.getUser,this),this.getLastWarning=br(this.getLastWarning,this),this.getLastActivity=br(this.getLastActivity,this),this.updateActivity=br(this.updateActivity,this),this.init=br(this.init,this),this.init()}return a.prototype.afkWarningCount=0,a.prototype.lastWarning=null,a.prototype["protected"]=!1,a.prototype.isInRoom=!0,a.prototype.init=function(){return this.lastActivity=new Date},a.prototype.updateActivity=function(){return this.lastActivity=new Date,this.afkWarningCount=0,this.lastWarning=null},a.prototype.getLastActivity=function(){return this.lastActivity},a.prototype.getLastWarning=function(){return this.lastWarning===null?!1:this.lastWarning},a.prototype.getUser=function(){return this.user},a.prototype.getWarningCount=function(){return this.afkWarningCount},a.prototype.getIsDj=function(){var a,b,c,d;a=API.getDJs();for(c=0,d=a.length;c<d;c++){b=a[c];if(this.user.id===b.id)return!0}return!1},a.prototype.warn=function(){return this.afkWarningCount++,this.lastWarning=new Date},a.prototype.notDj=function(){return this.afkWarningCount=0,this.lastWarning=null},a.prototype.inRoom=function(a){return this.isInRoom=a},a.prototype.updateVote=function(a){if(this.isInRoom)return t.voteLog[this.user.id][t.currentsong.id]=a,console.log("Pushed vote("+a.toString()+") to "+this.user.username+' for "'+t.currentsong.title+'"')},a}(),b=function(){function a(){}return a.prototype.lookupUser=function(a){var b,c,d;d=t.users;for(b in d){c=d[b];if(c.getUser().username===a)return c.getUser()}return!1},a.prototype.userVoteRatio=function(a){var b,c,d,e;console.log("vote log pull for "+a.username+":",t.voteLog[a.id]),c=t.voteLog[a.id],e={woot:0,meh:0};for(b in c)d=c[b],d===1?e.woot++:d===-1&&e.meh++;return e.positiveRatio=(e.woot/(e.woot+e.meh)).toFixed(2),e},a}(),P=function(){return API.sendChat("WERF")},M=function(){var a,b,d,e;b=API.getUsers(),t.djs=API.getDJs(),t.mods=API.getModerators(),t.host=API.getHost(),console.log("Users:",b);for(d=0,e=b.length;d<e;d++)a=b[d],t.users[a.id]=new c(a),t.voteLog[a.id]={}},E=function(){return document.getElementById("button-vote-positive").click(),document.getElementById("button-sound").click(),Playback.streamDisabled=!0,Playback.stop()},G=function(){return P(),M(),E(),F(),t.startup(),t.newSong(),t.startAfkInterval()},d=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;m=t.users,n=[];for(b in m)k=m[b],e=new Date,c=k.getLastActivity(),h=e.getTime()-c.getTime(),h>t.afkTime?k.getIsDj()?(g=h/1e3,k.getWarningCount()===0?(k.warn(),n.push(API.sendChat("@"+k.getUser().username+", I haven't seen you chat or vote in at least 12 minutes. Are you AFK?  If you don't show activity in 2 minutes I will remove you."))):k.getWarningCount()===1?(d=k.getLastWarning(),i=e.getTime()-d.getTime(),j=12e4,i>j?(k.warn(),l="@"+k.getUser().username,l+=", I haven't seen you chat or vote in at least 14 minutes now.  This is your second and FINAL warning.  If you do not chat or vote in the next minute I will remove you.",n.push(API.sendChat(l))):n.push(void 0)):k.getWarningCount()===2?(d=k.getLastWarning(),i=e.getTime()-d.getTime(),f=6e4,i>f?(a=API.getDJs(),a.length>0&&a[0].id!==k.getUser().id?(API.sendChat("@"+k.getUser().username+", you had 2 warnings. Please stay active by chatting or voting."),API.moderateRemoveDJ(b),n.push(k.warn())):n.push(void 0)):n.push(void 0)):k.getWarningCount()>=3?n.push(console.log("Have already attempted removing "+k.getUser().username+" but they are still on deck.")):n.push(void 0)):n.push(k.notDj()):n.push(void 0);return n},I=function(a){var b,c,d;return c="",d={days:0,hours:0,minutes:0,seconds:0},b={day:864e5,hour:36e5,minute:6e4,second:1e3},a>b.day&&(d.days=Math.floor(a/b.day),a%=b.day),a>b.hour&&(d.hours=Math.floor(a/b.hour),a%=b.hour),a>b.minute&&(d.minutes=Math.floor(a/b.minute),a%=b.minute),a>b.second&&(d.seconds=Math.floor(a/b.second)),d.days!==0&&(c+=d.days.toString()+"d"),d.hours!==0&&(c+=d.hours.toString()+"h"),d.minutes!==0&&(c+=d.minutes.toString()+"m"),d.seconds!==0&&(c+=d.seconds.toString()+"s"),c!==""?c:!1},a=function(){function a(a){this.msgData=a,this.init()}return a.prototype.init=function(){return this.parseType=null,this.command=null,this.rankPrivelege=null},a.prototype.functionality=function(a){},a.prototype.hasPrivelege=function(){var a;a=t.users[this.msgData.fromID].getUser();if(this.rankPrivelege==="host")return a.owner?!0:!1;if(this.rankPrivelege==="mod")return a.owner||a.moderator?!0:!1;if(this.rankPrivelege==="user")return!0},a.prototype.commandMatch=function(){var a,b,c,d,e;b=this.msgData.message;if(typeof this.command=="string"){if(this.parseType==="exact")return b===this.command?!0:!1;if(this.parseType==="startsWith")return b.substr(0,this.command.length)===this.command?!0:!1;if(this.parseType==="contains")return b.indexOf(this.command)!==-1?!0:!1}else if(typeof this.command=="object"){e=this.command;for(c=0,d=e.length;c<d;c++){a=e[c];if(this.parseType==="exact"){if(b===a)return!0}else if(this.parseType==="startsWith"){if(b.substr(0,a.length)===a)return!0}else if(this.parseType==="contains"&&b.indexOf(a)!==-1)return!0}return!1}},a.prototype.evalMsg=function(){return this.commandMatch()&&this.hasPrivelege()?(this.functionality(),!0):!1},a}(),N=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/protect",this.parseType="startsWith",this.rankPrivelege="mod"},b.prototype.functionality=function(){var a,b,c,d,e;b=this.msgData.message;if(b.length>9){d=b.substring(10),e=t.users;for(a in e){c=e[a];if(c.getUser().username===d){c["protected"]=!0,API.sendChat("I shall protect you @"+d+" (I just wont kick you)");return}}}API.sendChat("That aint no name I ever did see")},b}(a),p=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/cmdhelp",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c;a=this.msgData.message,c="";if(a.length>9){b=a.substring(9);switch(b){case"hugs pup":c="You give me a hug!";break;case"rapes pup":c="er... thats... not a command... please";break;case"taco":c="order a yummy taco.  simply say 'taco' or give on to someone else by saying 'taco @user'";break;case"cookie":c="Mod only command.  Reward a user with a sweet treat!  Syntax: cookie @user";break;case"punish":c="Mod only command.  Punish a user in one of several methods.  For naughty users.  Syntax: punish @user";break;case"/newsongs":c="find new songs by checking out one of 40+ dubstep channels that post new music daily";break;case"/whywoot":c="DJ all day without throwing your life away clicking woot every 3 minutes.  Learn how and get the necessary tools";break;case"/theme":c="Learn what genres of music are generally accepted here.  Don't forget to check if your song is in /overplayed though";break;case"/rules":c="Room rules.  Duh";break;case"/roomhelp":c="Information about the room for the newer folk.";break;case"/source":c="About the bot and the code that produced it";break;case"/sourcecode":c="About the bot and the code that produced it";break;case"/author":c="About the bot and the code that produced it";break;case"/woot":c="Remind users to hit woot so they don't get removed.  either type /woot or /woot @user";break;case".128":c="Mod only command. Flags songs that are bad quality.";break;case"/tableflip":c="... flips a table";break;case"/tablefix":c="... fixes a table";break;case"/download":c="Provides a link to find downloads of mp3 of current song";break;case"/smokesesh":c="For when ya just wanna get high";break;case"/smoke":c="doobies";break;case"/dab":c="WOLVES uses this";break;case"/afks":c="List current DJs on deck that haven't chatted or voted in 5+ minutes";break;case"/allafks":c="List all users in room that haven't chatted or voted in 10+ minutes";break;case"/status":c="Uptime and total song stats";break;case"/unhook events all":c="Host only command.  It's complicated";break;case"/die":c="Host only command. Makes bot go bye bye";break;case"/reload":c="Host only command. Reload pup's script";break;case"/lock":c="Mod only command. Locks booth";break;case"/unlock":c="Mod only command. Unlocks booth";break;case"/overplayed":c="Links users to our overplayed song list";break;case"/whymeh":c="Explains to users why they should be mehing every song";break;case"/skip":c="Mod only command.  Skips song.  Works for skipping invisible DJs.";break;case"/commands":c="Lists all commands.  Will only list commands available to caller's user class (user, mod, or host)";break;case"/resetafk":c="Mod only command.  Resets AFK timer for user.  Syntax: /resetafk @USER";break;case"/fb":c="Links to Dubstep Den's facebook page";break;case"/uservoice":c="Links to Dubstep Den's uservoice page";break;case"/dclookup":c="Mod only command.  Looks up user for a log of their last disconnect. Syntax: /dclookup @USER";break;case"/reminder":c='Mod only command.  Set reminder for x songs from now.  For users that dc\'d mainly.  Syntax: /reminder "MSG" [numsongs]';break;case"/voteratio":c="Mod only command.  See woot & meh count for user since bot launch.  Syntax: /voteratio @USER";break;case"/avgvoteratio":c="Mod only command.  See average voting ratio of every present user in room. Syntax: /avgvoteratio";break;case"/cmdhelp":c="Looks like you got it down";break;case"/pop":c="Mod only command.  Removes last person on deck";break;case"/push":c="Mod only command.  Puts user on deck. Syntax: /push @user";break;default:c="That is nothing.  That is not a thing."}}else c="Use this command to learn how use other commands.  Syntax: /cmdhelp [/CMD]";return API.sendChat(c)},b}(a),T=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/reminder",this.parseType="startsWith",this.rankPrivelege="mod"},b.prototype.functionality=function(){var a,b,c,d,e;return a=this.msgData.message,a.length>10?(c=a.slice(10),b=/^"(.+)"\s(\d)$/,e=b.exec(c),e!=null&&e.length===3?(d={songCount:parseInt(e[2])+t.songCount,msg:e[1]},t.reminders.push(d),API.sendChat("Ok I'm going to say '"+e[1]+"' in "+e[2]+" songs.")):(API.sendChat("look at that poopy ass syntax right there"),console.log(a,b,e))):API.sendChat("ur syntax is just plain poopy")},b}(a),D=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="hugs pup",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){return API.sendChat("hugs @"+this.msgData.from)},b}(a),R=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="rapes pup",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){return API.sendChat("slaps @"+this.msgData.from)},b}(a),be=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="taco",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.randomTaco=function(){var a,b;return b=["Mexican Pizza","Chicken Soft Taco","Double Decker Taco","Volcano Taco Supreme","Crunchy Taco Supreme","Grilled Steak Soft Taco","Cheesy Gordita Crunch","Doritos Locos Taco"],a=Math.floor(Math.random()*b.length),b[a]},b.prototype.functionality=function(){var a,b,c;return a=this.msgData.message,b=this.randomTaco(),a.substring(5,6)==="@"?(c=a.substring(6),c==="#Wolf Pup"?API.sendChat("No thanks I'll get fat :("):API.sendChat("Yo @"+c+", "+this.msgData.from+" just gave you a "+b+"!")):API.sendChat("Yo @"+this.msgData.from+", here is your "+b+"!")},b}(a),s=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return bu(c,a),c.prototype.init=function(){return this.command="cookie",this.parseType="startsWith",this.rankPrivelege="mod"},c.prototype.getCookie=function(){var a,b;return b=["a chocolate chip cookie","a sugar cookie","an oatmeal raisin cookie","a 'special' brownie","an animal cracker","a scooby snack","a blueberry muffin","a cupcake"],a=Math.floor(Math.random()*b.length),b[a]},c.prototype.functionality=function(){var a,c,d;a=this.msgData.message,c=new b;if(a.length>8)return d=c.lookupUser(a.substr(8)),d===!1?(API.sendChat("/em doesn't see '"+a.substr(8)+"' in room and eats cookie himself"),!1):API.sendChat("@"+d.username+", @"+this.msgData.from+" has rewarded you with "+this.getCookie()+". Enjoy.")},c}(a),O=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return bu(c,a),c.prototype.init=function(){return this.command="punish",this.parseType="startsWith",this.rankPrivelege="mod"},c.prototype.getPunishment=function(a){var b,c,d;return d=["/me rubs sandpaper on @{victim}'s scrotum","/me pokes @{victim} in the eyes","/me throws sand in @{victim}'s eyes","/me makes @{victim}'s mother cry","/me penetrates @{victim} with a sharpie","/me pinches @{victim}'s nipples super hard","/me gives @{victim} a wet willy"],b=Math.floor(Math.random()*d.length),c=d[b].replace("{victim}",a),c},c.prototype.functionality=function(){var a,c,d,e;a=this.msgData.message,d=new b;if(a.length>8)return c=a.substr(8),e=d.lookupUser(c),e===!1?(API.sendChat("/me punishes @"+this.msgData.from+" for getting the syntax wrong."),setTimeout(function(){return API.sendChat("Seriously though, I don't recognize the username '"+c+"'")},750)):e.owner?API.sendChat(this.getPunishment(this.msgData.from)):API.sendChat(this.getPunishment(e.username))},c}(a),J=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/newsongs",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c,d,e,f,g,h,i;return e=this.memberChannels.slice(0),c=this.channels.slice(0),a=this.artists.slice(0),d=function(a){var b,c;return b=a.length,c=Math.floor(Math.random()*b),a.splice(c,1)},g={channels:[],artist:""},h=t.users[this.msgData.fromID].getUser().username,h.indexOf("MistaDubstep")!==-1?g.channels.push("MistaDubstep"):h.indexOf("Underground Promotions")!==-1?g.channels.push("UndergroundDubstep"):g.channels.push(d(e)),g.channels.push(d(c)),g.channels.push(d(c)),b=API.getMedia(),(i=b.author,bs.call(a,i)>=0)?g.artist=b.author:g.artist=d(a),f="Everyone's heard that "+g.artist+" track! Get new music from http://youtube.com/"+g.channels[0]+" http://youtube.com/"+g.channels[1]+" or http://youtube.com/"+g.channels[2],API.sendChat(f)},b.prototype.memberChannels=["JitterStep","MistaDubstep","DubStationPromotions","UndergroundDubstep","JesusDied4Dubstep","DarkstepWarrior","BombshockDubstep","Sharestep"],b.prototype.channels=["BassRape","Mudstep","WobbleCraftDubz","MonstercatMedia","UKFdubstep","DropThatBassline","Dubstep","VitalDubstep","AirwaveDubstepTV","EpicNetworkMusic","NoOffenseDubstep","InspectorDubplate","ReptileDubstep","MrMoMDubstep","FrixionNetwork","IcyDubstep","DubstepWeed","VhileMusic","LessThan3Dubstep","PleaseMindTheDUBstep","ClownDubstep","TheULTRADUBSTEP","DuBM0nkeyz","DubNationUK","TehDubstepChannel","BassDropMedia","USdubstep","UNITEDubstep"],b.prototype.artists=["Skrillex","Doctor P","Excision","Flux Pavilion","Knife Party","Krewella","Rusko","Bassnectar","Nero","Deadmau5","Borgore","Zomboy"],b}(a),bp=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/whywoot",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b;return a="We dislike AFK djs. We calculate your AFK status by checking the last time you\t\t\tWoot'd or spoke. If you don't woot, I'll automagically remove you. Use our AutoWoot\t\t\tscript to avoid being removed: http://bit.ly/McZdWw",(b=this.msgData.message.indexOf("@"))!==-1?API.sendChat(this.msgData.message.substr(b)+", "+a):API.sendChat(a)},b}(a),bf=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/theme",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a;return a="Any type of Bass Music is allowed here. Including Dubstep, Complextro, Drum and Bass, ",a+="Garage, Breakbeat, Hardstyle, Moombahton, HEAVY EDM, House, Electro, and Trance!!",API.sendChat(a)},b}(a),W=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/rules",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a;return a="1) Play good sound quality music. ",a+="2) Don't replay a song on the room history. 3) Max song limit 8 minutes. ",a+="4) DO NOT GO AWAY FROM KEYBOARD ON DECK! Please WOOT on DJ Booth and respect your fellow DJs!",API.sendChat(a)},b}(a),V=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/roomhelp",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b;return a="Welcome to the Dubstep Den! Create a playlist and populate it with songs from either YouTube or Soundcloud.  ",a+="Click the 'Join Waitlist' button and wait your turn to play music. Most electronic music allowed, type '/theme' for specifics.",b="Stay active while waiting to play your song or I'll remove you.  Play good quality music that hasn't been played recently (check room history).  ",b+="Avoid over played artists like Skrillex. Ask a mod if you're unsure about your song choice",API.sendChat(a),setTimeout(function(){return API.sendChat(b)},750)},b}(a),_=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command=["/source","/sourcecode","/author"],this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a;return a="Backus wrote me in CoffeeScript.  A generalized version of me should be available on github soon!",API.sendChat(a)},b}(a),bq=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/woot",this.parseType="startsWith",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b;return a="Please WOOT on DJ Booth and support your fellow DJs! AutoWoot: http://bit.ly/Lwcis0",(b=this.msgData.message.indexOf("@"))!==-1?API.sendChat(this.msgData.message.substr(b)+", "+a):API.sendChat(a)},b}(a),l=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command=".128",this.parseType="exact",this.rankPrivelege="mod"},b.prototype.functionality=function(){var a;return a="Flagged for bad sound quality. Where do you get your music? The garbage can? Don't play this low quality tune again!",API.sendChat(a)},b}(a),bd=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/tableflip",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){return API.sendChat("(╯°□°）╯︵ ┻━┻")},b}(a),bc=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/tablefix",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){return API.sendChat(" ┬─┬ノ( º _ ºノ)")},b}(a),w=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/download",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c,d;return a=encodeURIComponent,b=a(t.currentsong.author),c=a(t.currentsong.title),d="Try this link for HIGH QUALITY DOWNLOAD: http://google.com/#hl=en&q=",d+=b+"%20-%20"+c,d+="%20site%3Azippyshare.com%20OR%20site%3Asoundowl.com%20OR%20site%3Ahulkshare.com%20OR%20site%3Asoundcloud.com",API.sendChat(d)},b}(a),Z=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command=["/smokesesh","/smoke","/dab"],this.parseType="exact",this.rankPrivelege="user"},b.prototype.smoke=function(){var a;return a=Math.floor(Math.random()*this.responses.length),this.responses[a]},b.prototype.functionality=function(){return API.sendChat(this.smoke())},b.prototype.responses=["If we all had a bong we'd all get along.","/me rolls a joint for you.","Got anything to eat?","Y-y-you're crazy....","THE COLORS. THE FUCKIN COLORS!","Everyone needs to give me a hug.","Need to blaze til' my eyes glaze."],b}(a),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/afks",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c,d,e,f,g;d="",c=API.getDJs();for(f=0,g=c.length;f<g;f++)a=c[f],e=new Date,b=e.getTime()-t.users[a.id].getLastActivity().getTime(),b>3e5&&I(b)!==!1&&(d+=a.username+" - "+I(b),d+=". ");return d===""?API.sendChat("No one is AFK"):API.sendChat("AFKs: "+d)},b}(a),f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/allafks",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c,d,e,f,g;a="",e=API.getUsers();for(f=0,g=e.length;f<g;f++)c=e[f],b=new Date,d=b.getTime()-t.users[c.id].getLastActivity().getTime(),d>6e5&&I(d)!==!1&&(a+=c.username+" - "+I(d),a+=". ");return a===""?API.sendChat("No one is AFK"):API.sendChat("AFKs: "+a)},b}(a),ba=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/status",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c,d,e,f,g,h,i,j;return d=t.launchTime,g=d.getMonth()+1,a=d.getDate(),b=d.getHours(),e=b%12===b?"AM":"PM",f=d.getMinutes(),f=f<10?"0"+f:f,i=t.totalVotingData,i.songs=t.songCount,c="Initiated "+g+"/"+a+" "+b+":"+f+" "+e+". ",j=""+i.songs+" songs have been played, accumulating "+i.woots+" woots, "+i.mehs+" mehs, and "+i.curates+" queues.",h=c+j,API.sendChat(h)},b}(a),bi=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/unhook events all",this.parseType="exact",this.rankPrivelege="host"},b.prototype.functionality=function(){return API.sendChat("Unhooking all events..."),bg()},b}(a),u=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/die",this.parseType="exact",this.rankPrivelege="host"},b.prototype.functionality=function(){return API.sendChat("Unhooking Events..."),bg(),API.sendChat("Deleting bot data..."),t.implode(),API.sendChat("Consider me dead")},b}(a),S=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/reload",this.parseType="exact",this.rankPrivelege="host"},b.prototype.functionality=function(){var a;return API.sendChat("brb"),bg(),a=t.pupScriptUrl,t.implode(),$.getScript(a)},b}(a),H=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/lock",this.parseType="exact",this.rankPrivelege="mod"},b.prototype.functionality=function(){return API.sendChat("Pop and lock dat ish"),t.lockBooth()},b}(a),bj=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/unlock",this.parseType="exact",this.rankPrivelege="mod"},b.prototype.functionality=function(){return API.sendChat("You'll never get the key to unlock my heart"),t.unlockBooth()},b}(a),bb=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return bu(c,a),c.prototype.init=function(){return this.command="/swap",this.parseType="startsWith",this.rankPrivelege="mod"},c.prototype.functionality=function(){var a,c,d,e,f,g;return a=this.msgData.message,d=new RegExp("^/swap @(.+) for @(.+)$"),g=d.exec(a).slice(1),c=new b,g.length===2?(f=c.lookupUser(g[0]),e=c.lookupUser(g[1]),f===!1||e===!1?(API.sendChat("Error parsing one or both names"),console.log("Err users",g,f,e),!1):t.lockBooth(function(){return API.moderateRemoveDJ(f.id),API.sendChat("Removing "+f.username+"..."),setTimeout(function(){return API.moderateAddDJ(e.id),API.sendChat("Adding "+e.username+"..."),setTimeout(function(){return t.unlockBooth()},1500)},1500)})):API.sendChat("Command didn't parse into two seperate usernames")},c}(a),L=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/pop",this.parseType="exact",this.rankPrivelege="mod"},b.prototype.functionality=function(){var a,b;return a=API.getDJs(),b=a[a.length-1],API.moderateRemoveDJ(b.id)},b}(a),Q=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return bu(c,a),c.prototype.init=function(){return this.command="/push",this.parseType="startsWith",this.rankPrivelege="mod"},c.prototype.functionality=function(){var a,c,d,e;a=this.msgData.message;if(a.length>this.command.length+2)return c=a.substr(this.command.length+2),d=new b,e=d.lookupUser(c),e!==!1?(API.moderateAddDJ(e.id),console.log("Adding User to DJ booth",e)):console.log("could not find user with name "+c)},c}(a),U=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/resetafk",this.parseType="startsWith",this.rankPrivelege="mod"},b.prototype.functionality=function(){var a,b,c,d;if(this.msgData.message.length>10){b=this.msgData.message.substring(11),d=t.users;for(a in d){c=d[a];if(c.getUser().username===b){c.updateActivity(),API.sendChat("@"+c.getUser().username+"'s AFK time has been reset.");return}}API.sendChat("Not sure who "+b+" is")}else API.sendChat("Yo Gimme a name r-tard")},b}(a),x=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/fb",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b;return a=Math.floor(Math.random()*this.msgs.length),b=this.msgs[a].replace("{fb}","http://on.fb.me/HNzK5S"),API.sendChat(b)},b.prototype.msgs=["Don't have any friends in real life? That's ok, we'll be your friend.  Join our facebook group: {fb}","Wondering what TIMarbury looks like?  Join our facebook group ({fb}) and find out for yourself!","We have a facebook group. Join it. Please. {fb}","The Dubstep Den is now on friendster! lol just kidding.  Here's our facebook group: {fb} you should join.","I bet you're handsome.  Join our facebook group so me0w can stalk your photos: {fb}"],b}(a),K=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/overplayed",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){return API.sendChat("View the list of songs we consider overplayed and suggest additions at http://den.johnback.us/overplayed_tracks")},b}(a),bm=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command=["/uservoice","/idea"],this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a;return a="Have an idea for the room, our bot, or an event?  Awesome! Submit it to our uservoice and we'll get started on it: http://is.gd/IzP4bA"
,a+=" (please don't ask for mod)",API.sendChat(a)},b}(a),Y=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/skip",this.parseType="exact",this.rankPrivelege="mod"},b.prototype.functionality=function(){return API.moderateForceSkip()},b}(a),bo=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/whymeh",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a;return a="Reserve Mehs for songs that are a) extremely overplayed b) off genre c) absolutely god awful or d) troll songs. ",a+="If you simply aren't feeling a song, then remain neutral",API.sendChat(a)},b}(a),r=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/commands",this.parseType="exact",this.rankPrivelege="user"},b.prototype.functionality=function(){var a,b,c,d,e,f,g,h,i,j,k,l;a=[],f=API.getUser(this.msgData.fromID),f.owner?a=["user","mod","host"]:f.moderator?a=["user","mod"]:a=["user"],e="";for(g=0,i=q.length;g<i;g++){d=q[g],b=new d("");if(k=b.rankPrivelege,bs.call(a,k)>=0)if(typeof b.command=="string")e+=b.command+", ";else if(typeof b.command=="object"){l=b.command;for(h=0,j=l.length;h<j;h++)c=l[h],e+=c+", "}}return e=e.substring(0,e.length-2),API.sendChat(e)},b}(a),v=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return bu(b,a),b.prototype.init=function(){return this.command="/dclookup",this.parseType="startsWith",this.rankPrivelege="mod"},b.prototype.functionality=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;a=this.msgData.message;if(a.length>11){j=a.slice(11),q=t.users;for(k in q){n=q[k];if(n.getUser().username===j){c=k,i=[],r=t.userDisconnectLog;for(o=0,p=r.length;o<p;o++)h=r[o],h.id===c&&i.push(h);if(i.length>0){m=n.getUser().username+" has disconnected "+i.length.toString()+" time",i.length===1?m+=". ":m+="s. ",l=i.pop(),b=l.time.getHours(),e=l.time.getMinutes(),e<10&&(e="0"+e.toString()),d=b%12===b?"AM":"PM",g=""+b+":"+e+" "+d,f=t.songCount-l.songCount,m+="Their most recent disconnect was at "+g+" ("+f+" songs ago). ",l.waitlistPosition!==void 0?(m+="They were "+l.waitlistPosition+" song",l.waitlistPosition>1&&(m+="s"),m+=" away from the DJ booth."):m+="They were not on the waitlist.",API.sendChat(m);return}API.sendChat("I haven't seen "+n.getUser().username+" disconnect.");return}}return API.sendChat("I don't see a user in the room named '"+j+"'.")}},b}(a),bn=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return bu(c,a),c.prototype.init=function(){return this.command="/voteratio",this.parseType="startsWith",this.rankPrivelege="mod"},c.prototype.functionality=function(){var a,c,d,e,f;return d=new b,a=this.msgData.message,a.length===10?console.log("bitches want room ratio"):a.length>12?(c=a.substr(12),e=d.lookupUser(c),e!==!1?(f=d.userVoteRatio(e),console.log(e.username+" votes:",f),a=e.username+" has wooted "+f.woot.toString()+" time",f.woot===1?a+=", ":a+="s, ",a+="and meh'd "+f.meh.toString()+" time",f.meh===1?a+=". ":a+="s. ",a+="Their woot:vote ratio is "+f.positiveRatio.toString()+".",API.sendChat(a)):API.sendChat("I don't recognize a user named '"+c+"'")):API.sendChat("I'm not sure what you want from me...")},c}(a),k=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return bu(c,a),c.prototype.init=function(){return this.command="/avgvoteratio",this.parseType="exact",this.rankPrivelege="mod"},c.prototype.functionality=function(){var a,c,d,e,f,g,h,i,j,k,l,m;f=[],d=new b,m=t.voteLog;for(g in m)j=m[g],h=t.users[g].getUser(),i=d.userVoteRatio(h),f.push(i.positiveRatio);a=0;for(k=0,l=f.length;k<l;k++)e=f[k],a+=e;return a/=f.length,c="Accounting for "+f.length.toString()+" user ratios, the average room ratio is "+a.toFixed(2).toString()+".",API.sendChat(c)},c}(a),q=[D,R,be,s,O,J,bp,bf,W,V,_,bq,l,bd,bc,w,Z,e,f,ba,bi,u,S,H,bj,bb,L,Q,K,bm,bo,Y,r,U,x,p,N,T,v,bn,k],n=function(a){var b,c,d,e,f;o(a),f=[];for(d=0,e=q.length;d<e;d++){c=q[d],b=new c(a);if(b.evalMsg())break;f.push(void 0)}return f},bl=function(a){return t.currentwoots=a.positive,t.currentmehs=a.negative,t.currentcurates=a.curates},g=function(a){return API.sendChat("/em: "+a.user.username+" loves this song!")},bk=function(a){return t.djs=API.getDJs()},z=function(a){return t.host=API.getHost(),t.mods=API.getModerators(),t.userJoin(a),t.users[a.id].updateActivity(),console.log(a.username+" joined the room"),API.sendChat("/em: "+a.username+" has joined the Den.")},y=function(a){t.intervalMessages();if(t.currentsong===null)return t.newSong();API.sendChat("/em: Just played "+t.currentsong.title+" by "+t.currentsong.author+". Stats: Woots: "+t.currentwoots+", Mehs: "+t.currentmehs+", Loves: "+t.currentcurates+"."),t.newSong(),document.getElementById("button-vote-positive").click();if(t.currentsong.author.indexOf("Skrillex")!==-1||t.currentsong.title.indexOf("Skrillex")!==-1)return API.sendChat("YO SKRILL DROP IT HARD!")},B=function(a){return t.users[a.user.id].updateActivity(),t.users[a.user.id].updateVote(a.vote)},A=function(a){var b,c,d,e,f;t.host=API.getHost(),t.mods=API.getModerators(),console.log(a.username+" left the room"),b={id:a.id,time:new Date,songCount:t.songCount},f=t.internalWaitlist;for(d=0,e=f.length;d<e;d++){c=f[d];if(c.id===a.id){b.waitlistPosition=i+1,t.setInternalWaitlist();break}}return t.userDisconnectLog.push(b),console.log("User disconnect logged",t.userDisconnectLog),t.users[a.id].inRoom(!1)},h=function(a){var b,c;b=/(\bhttps?:\/\/(www.)?plug\.dj[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;if(b.exec(a.message)){c=API.getUser(a.fromID);if(!c.ambassador&&!c.moderator&&!c.owner&&!c.superuser)return t.users[a.fromID]["protected"]?API.sendChat("I'm supposed to kick you, but you're just too darn pretty."):(API.sendChat("Don't spam room links you ass clown"),API.moderateDeleteChat(a.chatID))}},m=function(a){var b,c,d;b=a.message.toLowerCase(),d=["Good idea @{beggar}!  Don't earn your fans or anything thats so yesterday","Guys @{beggar} asked us to fan him!  Lets all totally do it! ಠ_ಠ","srsly @{beggar}? ಠ_ಠ","@{beggar}.  Earning his fans the good old fashioned way.  Hard work and elbow grease.  A true american."],c=Math.floor(Math.random()*d.length);if(b.indexOf("fan me")!==-1||b.indexOf("fan for fan")!==-1||b.indexOf("fan pls")!==-1||b.indexOf("fan4fan")!==-1)return API.sendChat(d[c].replace("{beggar}",a.from))},o=function(a){return t.activity(a),h(a),m(a)},C=function(a,b){return API.addEventListener(a,b)},bh=function(a,b){return API.removeEventListener(a,b)},j=[{event:API.ROOM_SCORE_UPDATE,callback:bl},{event:API.CURATE_UPDATE,callback:g},{event:API.DJ_UPDATE,callback:bk},{event:API.USER_JOIN,callback:z},{event:API.DJ_ADVANCE,callback:y},{event:API.VOTE_UPDATE,callback:B},{event:API.CHAT,callback:n},{event:API.USER_LEAVE,callback:A}],F=function(){var a,b,c,d;d=[];for(b=0,c=j.length;b<c;b++)a=j[b],d.push(C(a.event,a.callback));return d},bg=function(){var a,b,c,d;d=[];for(b=0,c=j.length;b<c;b++)a=j[b],d.push(bh(a.event,a.callback));return d},G()})).call(this);